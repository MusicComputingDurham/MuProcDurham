

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Practical: Sequential Models &mdash; muprocdurham  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/autoclasstoc.css?v=08871587" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Practical: Hierarchical Models" href="Practical_Hierarchical_Models.html" />
    <link rel="prev" title="Spectrograms &amp; Overtones" href="Lecture_From_Overtones_to_Tuning_Systems_and_Harmonies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            muprocdurham
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MuProcDurham Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Lecture_From_Overtones_to_Tuning_Systems_and_Harmonies.html">Spectrograms &amp; Overtones</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Practical: Sequential Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unigram-counts">Unigram Counts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Hierarchical_Models.html">Practical: Hierarchical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Shepard_Tones_and_Pitch-Class_Embeddings.html">Shepard Tones</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Tonnetz_Generation.html">Tonnetz Generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">muprocdurham</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">MuProcDurham Gallery</a></li>
      <li class="breadcrumb-item active">Practical: Sequential Models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-practical-sequential-models-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="practical-sequential-models">
<span id="sphx-glr-auto-examples-practical-sequential-models-py"></span><h1>Practical: Sequential Models<a class="headerlink" href="#practical-sequential-models" title="Link to this heading"></a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Practical: Sequential Models</span>

<span class="c1"># ## Reading in a Sequence</span>

<span class="c1"># Write a function that extracts the MIDI pitch sequence from a music21 score and returns it as a Numpy array. Tied notes should be represented by a single pitch. If the input contains chords (notes with same onset time) it should (optionally) raise a ``RuntimeError`` or ignore them. It should be possible to provide a minimum and maximum time (in quarter beats) to specify a region of interest.</span>
<span class="c1">#</span>
<span class="c1"># *Hints:*</span>
<span class="c1"># - ``score.flat`` is an iterable over *all* elements in the score</span>
<span class="c1"># - ``m21.note.Note`` and ``m21.chord.Chord`` are base classes for single notes and chords respectively</span>
<span class="c1"># - use ``element.tie`` with [``m21.tie.Tie``](https://web.mit.edu/music21/doc/moduleReference/moduleTie.html) to check for tied notes</span>
<span class="c1"># - use ``element.offset`` to check for time constraints.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">muprocdurham</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">music21</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">m21</span>

<span class="n">mpd</span><span class="o">.</span><span class="n">seed_everything</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pitch_sequence</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">ignore_chords</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">pitches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="c1"># traverse all elements in the score</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">score</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">m21</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tie</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">element</span><span class="o">.</span><span class="n">tie</span> <span class="o">==</span> <span class="n">m21</span><span class="o">.</span><span class="n">tie</span><span class="o">.</span><span class="n">Tie</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)):</span>
            <span class="c1"># check for min/max time</span>
            <span class="k">if</span> <span class="n">min_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="n">min_time</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">max_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">max_time</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># get MIDI pitch for single notes</span>
            <span class="n">pitches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">midi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">m21</span><span class="o">.</span><span class="n">chord</span><span class="o">.</span><span class="n">Chord</span><span class="p">):</span>
            <span class="c1"># ignore chords or raise error</span>
            <span class="k">if</span> <span class="n">ignore_chords</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input contains chords </span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">element</span><span class="o">.</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ignore anything else</span>
            <span class="k">continue</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span>


<span class="c1"># You can use and extend the following function to convert pitch sequences to other types if needed.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pitchtypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">EnharmonicPitch</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">to</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">to</span> <span class="o">==</span> <span class="s2">&quot;pitch classes&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">pitch</span> <span class="o">%</span> <span class="mi">12</span> <span class="k">for</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">to</span> <span class="o">==</span> <span class="s2">&quot;named pitch&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">EnharmonicPitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span> <span class="k">for</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">to</span> <span class="o">==</span> <span class="s2">&quot;named pitch classes&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">EnharmonicPitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span><span class="o">.</span><span class="n">to_class</span><span class="p">()</span> <span class="k">for</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sequence</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown conversion request to &#39;</span><span class="si">{</span><span class="n">to</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>


<span class="c1"># Test your implementation on the C Major Prelude. It should start with the MIDI pitches ``[60, 64, 67, 72, 76, 67, 72, 76, 60, 64, 67, 72, 76, 67, 72, 76, ...]`` (first two bars).</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">score</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;bach/bwv846.mxl&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pitch_sequence</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">ignore_chords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># s = convert(s, to=&quot;pitch classes&quot;)</span>
<span class="c1"># s = convert(s, to=&quot;named pitch&quot;)</span>
<span class="c1"># s = convert(s, to=&quot;named pitch classes&quot;)</span>
<span class="n">s</span>


<span class="c1"># ## Simple *n*-gram Model</span>

<span class="c1"># Complete the following template class for an *n*-gram model.</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>array([60, 64, 67, 72, 76, 67, 72, 76, 60, 64, 67, 72, 76, 67, 72, 76, 60,
       62, 69, 74, 77, 69, 74, 77, 60, 62, 69, 74, 77, 69, 74, 77, 59, 62,
       67, 74, 77, 67, 74, 77, 59, 62, 67, 74, 77, 67, 74, 77, 60, 64, 67,
       72, 76, 67, 72, 76, 60, 64, 67, 72, 76, 67, 72, 76, 60, 64, 69, 76,
       81, 69, 76, 81, 60, 64, 69, 76, 81, 69, 76, 81, 60, 62, 66, 69, 74,
       66, 69, 74, 60, 62, 66, 69, 74, 66, 69, 74, 59, 62, 67, 74, 79, 67,
       74, 79, 59, 62, 67, 74, 79, 67, 74, 79, 59, 60, 64, 67, 72, 64, 67,
       72, 59, 60, 64, 67, 72, 64, 67, 72, 57, 60, 64, 67, 72, 64, 67, 72,
       57, 60, 64, 67, 72, 64, 67, 72, 50, 57, 62, 66, 72, 62, 66, 72, 50,
       57, 62, 66, 72, 62, 66, 72, 55, 59, 62, 67, 71, 62, 67, 71, 55, 59,
       62, 67, 71, 62, 67, 71, 55, 58, 64, 67, 73, 64, 67, 73, 55, 58, 64,
       67, 73, 64, 67, 73, 53, 57, 62, 69, 74, 62, 69, 74, 53, 57, 62, 69,
       74, 62, 69, 74, 53, 56, 62, 65, 71, 62, 65, 71, 53, 56, 62, 65, 71,
       62, 65, 71, 52, 55, 60, 67, 72, 60, 67, 72, 52, 55, 60, 67, 72, 60,
       67, 72, 52, 53, 57, 60, 65, 57, 60, 65, 52, 53, 57, 60, 65, 57, 60,
       65, 50, 53, 57, 60, 65, 57, 60, 65, 50, 53, 57, 60, 65, 57, 60, 65,
       43, 50, 55, 59, 65, 55, 59, 65, 43, 50, 55, 59, 65, 55, 59, 65, 48,
       52, 55, 60, 64, 55, 60, 64, 48, 52, 55, 60, 64, 55, 60, 64, 48, 55,
       58, 60, 64, 58, 60, 64, 48, 55, 58, 60, 64, 58, 60, 64, 41, 53, 57,
       60, 64, 57, 60, 64, 41, 53, 57, 60, 64, 57, 60, 64, 42, 48, 57, 60,
       63, 57, 60, 63, 42, 48, 57, 60, 63, 57, 60, 63, 44, 53, 59, 60, 62,
       59, 60, 62, 44, 53, 59, 60, 62, 59, 60, 62, 43, 53, 55, 59, 62, 55,
       59, 62, 43, 53, 55, 59, 62, 55, 59, 62, 43, 52, 55, 60, 64, 55, 60,
       64, 43, 52, 55, 60, 64, 55, 60, 64, 43, 50, 55, 59, 65, 55, 59, 65,
       43, 50, 55, 59, 65, 55, 59, 65, 43, 51, 57, 60, 66, 57, 60, 66, 43,
       51, 57, 60, 66, 57, 60, 66, 43, 52, 55, 60, 67, 55, 60, 67, 43, 52,
       55, 60, 67, 55, 60, 67, 43, 50, 55, 60, 65, 55, 60, 65, 43, 50, 55,
       60, 65, 55, 60, 65, 43, 50, 55, 59, 65, 55, 59, 65, 43, 50, 55, 59,
       65, 55, 59, 65, 36, 48, 55, 58, 64, 55, 58, 64, 36, 48, 55, 58, 64,
       55, 58, 64, 36, 48, 53, 57, 60, 65, 60, 57, 60, 57, 53, 57, 53, 50,
       53, 50, 36, 47, 67, 71, 74, 77, 74, 71, 74, 71, 67, 71, 62, 65, 64,
       62])
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NGramModel</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">prior_counts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>                        <span class="c1"># order of the n-gram model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>                  <span class="c1"># dict with counts for the individual n-grams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_counts</span> <span class="o">=</span> <span class="n">prior_counts</span>  <span class="c1"># prior counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span>     <span class="c1"># alphabet of symbols</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fill_alphabet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fill gaps in integer alphabet&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_n_gram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_gram</span><span class="p">):</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;n-gram must have length n=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, but </span><span class="si">{</span><span class="n">n_gram</span><span class="si">}</span><span class="s2"> has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">n_gram</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_gram</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an *n*-gram by initialising or incrementing its count.&quot;&quot;&quot;</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_n_gram</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> \
            <span class="sa">f</span><span class="s2">&quot;n-gram has wrong length, expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add all *n*-grams in the sequence.&quot;&quot;&quot;</span>
        <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">n_gram</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_gram</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return counts for this *n*-gram.&quot;&quot;&quot;</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_n_gram</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_counts</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_counts</span>
        <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_gram</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return probability of the last element in the *n*-gram conditional on the first ``n-1`` elements.&quot;&quot;&quot;</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_n_gram</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="n">n_gram</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">,))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphabet</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span>
        <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># Train a unigram model on pitch classes and plot the distribution.</span>
<span class="c1">#</span>
<span class="c1"># *Hint:* Use the provided function for plotting.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">muprocdurham.ngram</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_unigram_distribution</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">pitch_sequence</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">m21</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;bach/bwv846.mxl&#39;</span><span class="p">))</span>
<span class="n">n_gram_model</span> <span class="o">=</span> <span class="n">NGramModel</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;pitch classes&quot;</span><span class="p">)</span>
<span class="n">n_gram_model</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">n_gram_model</span><span class="o">.</span><span class="n">fill_alphabet</span><span class="p">()</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="nb">print</span><span class="p">(</span><span class="n">n_gram_model</span><span class="o">.</span><span class="n">counts</span><span class="p">)</span>
<span class="n">show_unigram_distribution</span><span class="p">(</span><span class="n">n_gram_model</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pitch_classes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Train a bigram model on the pitch sequence and plot</span>
<span class="c1"># 1. the matrix of counts</span>
<span class="c1"># 2. the matrix of transition probabilities.</span>
<span class="c1">#</span>
<span class="c1"># Experiment with different levels for the prior counts.</span>
<span class="c1">#</span>
<span class="c1"># *Hint:* Use the provided functions for creating the matrices and plotting them.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Sequential_Models_001.png" srcset="../_images/sphx_glr_Practical_Sequential_Models_001.png" alt="Practical Sequential Models" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{(0,): 102, (4,): 61, (7,): 106, (2,): 71, (9,): 50, (5,): 59, (11,): 41, (6,): 14, (10,): 10, (1,): 4, (8,): 4, (3,): 6}
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">muprocdurham.ngram</span><span class="w"> </span><span class="kn">import</span> <span class="n">bigram_matrix_from_model</span><span class="p">,</span> <span class="n">show_bigram_matrix</span>

<span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pitch_sequence</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">m21</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;bach/bwv846.mxl&#39;</span><span class="p">))</span>
<span class="n">n_gram_model</span> <span class="o">=</span> <span class="n">NGramModel</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">n_gram_model</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">n_gram_model</span><span class="o">.</span><span class="n">fill_alphabet</span><span class="p">()</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="k">for</span> <span class="n">prior_counts</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="n">n_gram_model</span><span class="o">.</span><span class="n">prior_counts</span> <span class="o">=</span> <span class="n">prior_counts</span>
    <span class="k">for</span> <span class="n">mat</span><span class="p">,</span> <span class="n">minmax</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">bigram_matrix_from_model</span><span class="p">(</span><span class="n">n_gram_model</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">bigram_matrix_from_model</span><span class="p">(</span><span class="n">n_gram_model</span><span class="p">),</span>
    <span class="p">]:</span>
        <span class="n">show_bigram_matrix</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="n">minmax</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># ## Exercise by Hand</span>

<span class="c1"># For the following sequence, count the pitch-class unigrams and bigrams and note them in a table like these:</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Sequential_Models_002.png" srcset="../_images/sphx_glr_Practical_Sequential_Models_002.png" alt="Practical Sequential Models" class = "sphx-glr-single-img"/><section id="unigram-counts">
<h2>Unigram Counts<a class="headerlink" href="#unigram-counts" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">C   | C#   | D   | D#   | E   | F   | F#   | G   | G#   | A   | A#   | B   |</div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">|----|</span></a> —- <a href="#id3"><span class="problematic" id="id4">|----|</span></a> —- <a href="#id5"><span class="problematic" id="id6">|----|</span></a>—-| —- <a href="#id7"><span class="problematic" id="id8">|----|</span></a> —- <a href="#id9"><span class="problematic" id="id10">|----|</span></a> —- <a href="#id11"><span class="problematic" id="id12">|----|</span></a>
|    |      |    |      |    |    |      |    |      |    |      |    |</p>
<p>%%
Bigram Counts (rows: from; columns: to)
—————————————</p>
<div class="line-block">
<div class="line-block">
<div class="line">| C   | C#   | D   | D#   | E   | F   | F#   | G   | G#   | A   | A#   | B   |</div>
</div>
<div class="line">—- <a href="#id13"><span class="problematic" id="id14">|----|</span></a> —- <a href="#id15"><span class="problematic" id="id16">|----|</span></a> —- <a href="#id17"><span class="problematic" id="id18">|----|</span></a>—-| —- <a href="#id19"><span class="problematic" id="id20">|----|</span></a> —- <a href="#id21"><span class="problematic" id="id22">|----|</span></a> —- <a href="#id23"><span class="problematic" id="id24">|----|</span></a></div>
<div class="line">C    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">C#   |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">D    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">D#   |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">E    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">F    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">F#   |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">G    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">G#   |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">A    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">A#   |    |      |    |      |    |    |      |    |      |    |      |    |</div>
<div class="line">B    |    |      |    |      |    |    |      |    |      |    |      |    |</div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># s = pitch_sequence(m21.corpus.parse(&#39;bach/bwv846.mxl&#39;), max_time=4)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pitch_sequence</span><span class="p">(</span><span class="n">m21</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;./Take the A Train Theme.mid&#39;</span><span class="p">))</span>


<span class="n">score</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">Score</span><span class="p">()</span>
<span class="n">part</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">Part</span><span class="p">()</span>
<span class="n">measure</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">Measure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">measure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m21</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">EnharmonicPitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">)),</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;16th&quot;</span><span class="p">))</span>
<span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
<span class="n">score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
<span class="n">mpd</span><span class="o">.</span><span class="n">show_stream</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>


<span class="c1"># Assume the unigram and bigram counts are used in a multi-order *n*-gram model that always uses the highest-order *n*-gram possible (the one with largest n) for predicting the next note. If the melody had been generated using this model, and ignoring the octave (i.e. treating the notes as pitch classes), what are the probabilities for the respective notes?</span>
<span class="c1">#</span>
<span class="c1"># *Hint:* You can use the output of following to check your solution.</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/MuProcDurham/MuProcDurham/muprocdurham/__init__.py:44: UserWarning: Cannot show score, falling back to text representation.
  warn(&quot;Cannot show score, falling back to text representation.&quot;, UserWarning)
{0.0} &lt;music21.stream.Part 0x7f7a326d3130&gt;
    {0.0} &lt;music21.stream.Measure 0 offset=0.0&gt;
        {0.0} &lt;music21.note.Note G&gt;
        {0.25} &lt;music21.note.Note E&gt;
        {0.5} &lt;music21.note.Note G&gt;
        {0.75} &lt;music21.note.Note C&gt;
        {1.0} &lt;music21.note.Note E&gt;
        {1.25} &lt;music21.note.Note G#&gt;
        {1.5} &lt;music21.note.Note A&gt;
        {1.75} &lt;music21.note.Note A&gt;
        {2.0} &lt;music21.note.Note A#&gt;
        {2.25} &lt;music21.note.Note B&gt;
        {2.5} &lt;music21.note.Note E&gt;
        {2.75} &lt;music21.note.Note G&gt;
        {3.0} &lt;music21.note.Note F#&gt;
        {3.25} &lt;music21.note.Note F&gt;
        {3.5} &lt;music21.note.Note C#&gt;
        {3.75} &lt;music21.note.Note C&gt;
        {4.0} &lt;music21.note.Note E&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;pitch classes&quot;</span><span class="p">)</span>

<span class="n">unigram_model</span> <span class="o">=</span> <span class="n">NGramModel</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>
<span class="n">unigram_model</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">show_unigram_distribution</span><span class="p">(</span><span class="n">unigram_model</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pitch_classes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">bigram_model</span> <span class="o">=</span> <span class="n">NGramModel</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>
<span class="n">bigram_model</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">bigram_model</span><span class="o">.</span><span class="n">fill_alphabet</span><span class="p">()</span>

<span class="n">show_bigram_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">bigram_matrix_from_model</span><span class="p">(</span><span class="n">bigram_model</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">show_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pitch_classes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
    <span class="n">unigram</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],)</span>
    <span class="n">p_unigram</span> <span class="o">=</span> <span class="n">unigram_model</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">unigram</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bigram</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p_bigram</span> <span class="o">=</span> <span class="n">bigram_model</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">bigram</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bigram</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">p_bigram</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">EnharmonicPitch</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to_class</span><span class="p">()</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="n">p_unigram</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">p_bigram</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>


<span class="c1"># ## Smoothing *n*-gram Model</span>

<span class="c1"># Use the template class below to implement a smoothing *n*-gram model.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Sequential_Models_003.png" srcset="../_images/sphx_glr_Practical_Sequential_Models_003.png" alt="Practical Sequential Models" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>G: (0.17647058823529413, None)
E: (0.23529411764705882, 0.3333333333333333)
G: (0.17647058823529413, 0.6666666666666666)
C: (0.11764705882352941, 0.3333333333333333)
E: (0.23529411764705882, 1.0)
G#: (0.058823529411764705, 0.3333333333333333)
A: (0.11764705882352941, 1.0)
A: (0.11764705882352941, 0.5)
A#: (0.058823529411764705, 0.5)
B: (0.058823529411764705, 1.0)
E: (0.23529411764705882, 1.0)
G: (0.17647058823529413, 0.6666666666666666)
F#: (0.058823529411764705, 0.3333333333333333)
F: (0.058823529411764705, 1.0)
C#: (0.058823529411764705, 1.0)
C: (0.11764705882352941, 1.0)
E: (0.23529411764705882, 1.0)
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SmoothingNGramModel</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">prior_counts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prior_counts</span> <span class="o">=</span> <span class="n">prior_counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_models</span> <span class="o">=</span> <span class="p">{</span><span class="n">n_</span><span class="p">:</span> <span class="n">NGramModel</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_</span><span class="p">,</span> <span class="n">prior_counts</span><span class="o">=</span><span class="n">prior_counts</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">alphabet</span><span class="p">)</span> <span class="k">for</span> <span class="n">n_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prior_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prior_counts</span>

    <span class="nd">@prior_counts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prior_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prior_counts</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_models</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">model</span><span class="o">.</span><span class="n">prior_counts</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alphabet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">alphabet</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_models</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fill_alphabet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_models</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">model</span><span class="o">.</span><span class="n">fill_alphabet</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_models</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_gram</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">n_gram</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">n_gram</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
        <span class="n">n_gram_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gram_models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># stop recursion</span>
            <span class="k">return</span> <span class="n">n_gram_prediction</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># recurse and smooth</span>
            <span class="k">return</span> <span class="n">w</span> <span class="o">*</span> <span class="n">n_gram_prediction</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">n_gram</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span>


<span class="c1"># Test your implementation on a simple bigram version. What effect do you observe when smoothing over bigrams and unigrams?</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">pitch_sequence</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">m21</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;bach/bwv846.mxl&#39;</span><span class="p">))</span>
<span class="n">n_gram_model</span> <span class="o">=</span> <span class="n">SmoothingNGramModel</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">n_gram_model</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">n_gram_model</span><span class="o">.</span><span class="n">fill_alphabet</span><span class="p">()</span>

<span class="n">mat</span><span class="p">,</span> <span class="n">minmax</span> <span class="o">=</span> <span class="n">bigram_matrix_from_model</span><span class="p">(</span><span class="n">n_gram_model</span><span class="p">)</span>
<span class="n">show_bigram_matrix</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="n">minmax</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Sequential_Models_004.png" srcset="../_images/sphx_glr_Practical_Sequential_Models_004.png" alt="Practical Sequential Models" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.061 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-practical-sequential-models-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/aa8b15b9f3599bb330a10cf04949faa8/Practical_Sequential_Models.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">Practical_Sequential_Models.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/7f77005f5ac5da6f61e253a109c6ceeb/Practical_Sequential_Models.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">Practical_Sequential_Models.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/74a5c9b6e73bcfc5f989ae28fb7c6912/Practical_Sequential_Models.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">Practical_Sequential_Models.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Lecture_From_Overtones_to_Tuning_Systems_and_Harmonies.html" class="btn btn-neutral float-left" title="Spectrograms &amp; Overtones" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Practical_Hierarchical_Models.html" class="btn btn-neutral float-right" title="Practical: Hierarchical Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Robert Lieck, Eamonn Bell, Mark Gotham.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>