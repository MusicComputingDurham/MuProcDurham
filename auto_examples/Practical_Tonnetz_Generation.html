

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tonnetz Generation &mdash; muprocdurham  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/autoclasstoc.css?v=08871587" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Summary" href="../api_summary.html" />
    <link rel="prev" title="Shepard Tones" href="Practical_Shepard_Tones_and_Pitch-Class_Embeddings.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            muprocdurham
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MuProcDurham Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Lecture_From_Overtones_to_Tuning_Systems_and_Harmonies.html">Spectrograms &amp; Overtones</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Sequential_Models.html">Practical: Sequential Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Hierarchical_Models.html">Practical: Hierarchical Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="Practical_Shepard_Tones_and_Pitch-Class_Embeddings.html">Shepard Tones</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tonnetz Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hints">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Hints:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-ncc">On NCC:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">muprocdurham</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">MuProcDurham Gallery</a></li>
      <li class="breadcrumb-item active">Tonnetz Generation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-practical-tonnetz-generation-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="tonnetz-generation">
<span id="sphx-glr-auto-examples-practical-tonnetz-generation-py"></span><h1>Tonnetz Generation<a class="headerlink" href="#tonnetz-generation" title="Link to this heading"></a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install muprocdurham  # latest release</span>
<span class="c1"># !pip install git+https://github.com/MusicComputingDurham/MuProcDurham.git@main  # latest main version (typically same as release)</span>
<span class="c1"># !pip install git+https://github.com/MusicComputingDurham/MuProcDurham.git@dev  # latest dev version</span>


<span class="c1"># # Tonnetz Generation</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">patches</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">music21</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">m21</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">muprocdurham.sound</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pitchtypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Spelled</span><span class="p">,</span> <span class="n">Enharmonic</span>
<span class="c1"># !pip install pygame</span>


<span class="c1"># This practical is about using the Tonnetz as a starting point to generate music.</span>

<span class="c1"># ## Visualisation</span>

<span class="c1"># Below is a helper class (using a static class, similar to a module, to avoide polluting the global namespace) to plot the Tonnetz and some related functionality for visualising things on the Tonnetz.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Tonnetz</span><span class="p">:</span>
    <span class="c1"># basic grid layout; transform (N, 2)-shaped arrays of indices to coordinates with &#39;indices @ basis&#39;</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)],</span>
    <span class="c1">#     [0., 1.],</span>
    <span class="p">])</span>
    <span class="c1"># in continuous space</span>
<span class="c1">#     unit_cell = [[0, 0], [4, -1], [4, 2], [0, 3]]</span>
<span class="c1">#     unit_cell_offset = [-2, -1]</span>
    <span class="c1"># on pitch classes</span>
    <span class="n">unit_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
    <span class="n">unit_cell_offset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1"># including chords</span>
    <span class="n">unit_cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">unit_cell_offset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1"># chords</span>
    <span class="n">major_triangle</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">@</span> <span class="n">basis</span>
    <span class="n">minor_triangle</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">@</span> <span class="n">basis</span>
    <span class="n">ma_off</span> <span class="o">=</span> <span class="n">major_triangle</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># offset of a major triad</span>
    <span class="n">mi_off</span> <span class="o">=</span> <span class="n">minor_triangle</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># offset of a minor triad</span>
    <span class="c1"># plotting</span>
    <span class="n">pitch_spelling</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;just&#39;</span><span class="p">,</span> <span class="s1">&#39;spelled&#39;</span><span class="p">,</span> <span class="s1">&#39;enharmonic&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># which pitch spelling to use</span>
    <span class="n">font_scale</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># font rescaling</span>
    <span class="n">margin_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># margin around the unit cell</span>
    <span class="n">centre_pitch_class</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="c1"># pitch class at [0, 0]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># axis to plot to</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="p">):</span>
        <span class="c1"># unit cell and plotting range</span>
        <span class="n">unit_cell_</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Tonnetz</span><span class="o">.</span><span class="n">unit_cell</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Tonnetz</span><span class="o">.</span><span class="n">unit_cell_offset</span><span class="p">))</span> <span class="o">@</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">basis</span>
        <span class="n">unit_cell_margin</span> <span class="o">=</span> <span class="n">unit_cell_</span> <span class="o">+</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">margin_factor</span> <span class="o">*</span> <span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">@</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
        <span class="n">min_xy</span> <span class="o">=</span> <span class="n">unit_cell_margin</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">max_xy</span> <span class="o">=</span> <span class="n">unit_cell_margin</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># for drawing pitches and chords</span>
        <span class="n">hex_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="o">@</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">basis</span>
        <span class="n">hex_vertices</span> <span class="o">=</span> <span class="p">(</span><span class="n">hex_vertices</span> <span class="o">+</span> <span class="n">hex_vertices</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">])</span> <span class="o">/</span> <span class="mi">3</span>

        <span class="c1"># check pitch spelling</span>
        <span class="n">font_scale_</span> <span class="o">=</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">font_scale</span>
        <span class="k">if</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">pitch_spelling</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;just&#39;</span><span class="p">,</span> <span class="s1">&#39;spelled&#39;</span><span class="p">]:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Spelled</span><span class="o">.</span><span class="n">PitchClass</span><span class="p">(</span><span class="n">Tonnetz</span><span class="o">.</span><span class="n">centre_pitch_class</span><span class="p">)</span>
            <span class="n">fifth</span> <span class="o">=</span> <span class="n">Spelled</span><span class="o">.</span><span class="n">IntervalClass</span><span class="p">(</span><span class="s1">&#39;P5&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Enharmonic</span><span class="o">.</span><span class="n">PitchClass</span><span class="p">(</span><span class="n">Tonnetz</span><span class="o">.</span><span class="n">centre_pitch_class</span><span class="p">)</span>
            <span class="n">fifth</span> <span class="o">=</span> <span class="n">Enharmonic</span><span class="o">.</span><span class="n">IntervalClass</span><span class="p">(</span><span class="s1">&#39;P5&#39;</span><span class="p">)</span>
            <span class="n">font_scale_</span> <span class="o">*=</span> <span class="mf">1.5</span>

        <span class="c1"># generate the grid</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fifths</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">thirds</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">fifths</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">thirds</span><span class="p">)</span> <span class="o">*</span> <span class="n">fifth</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">pitch_spelling</span> <span class="o">==</span> <span class="s1">&#39;just&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">thirds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">*</span> <span class="n">thirds</span>
                    <span class="k">if</span> <span class="n">thirds</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span> <span class="o">*</span> <span class="o">-</span><span class="n">thirds</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">fifths</span><span class="p">,</span> <span class="n">thirds</span><span class="p">])</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">steps</span> <span class="o">@</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">basis</span>

        <span class="c1"># plot everything</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xy_</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">xy_</span> <span class="o">&lt;</span> <span class="n">min_xy</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">xy_</span> <span class="o">&gt;</span> <span class="n">max_xy</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># pitches</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">hex_vertices</span> <span class="o">+</span> <span class="n">xy_</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">xy_</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xy_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_scale_</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="c1"># major chords</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">ma_off</span> <span class="o">+</span> <span class="n">xy_</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">Tonnetz</span><span class="o">.</span><span class="n">major_triangle</span> <span class="o">+</span> <span class="n">xy_</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ma</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_scale_</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="c1"># minor chords</span>
            <span class="n">mi</span> <span class="o">=</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">mi_off</span> <span class="o">+</span> <span class="n">xy_</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">Tonnetz</span><span class="o">.</span><span class="n">minor_triangle</span> <span class="o">+</span> <span class="n">xy_</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">mi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_scale_</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">unit_cell_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Index array must be 2D&quot;</span>
        <span class="k">assert</span> <span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Second dimension of index array must contain (fifths, thirds)-steps&quot;</span>
        <span class="k">return</span> <span class="n">idx</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">indices_to_coords</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">check_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="o">@</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">basis</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remap_to_unit_cell</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">check_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">-</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">unit_cell_offset</span>
        <span class="k">for</span> <span class="n">cond</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]),</span>
        <span class="p">]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">cond</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offset</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">cond</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">Tonnetz</span><span class="o">.</span><span class="n">unit_cell_offset</span>

<span class="n">TN</span> <span class="o">=</span> <span class="n">Tonnetz</span>  <span class="c1"># like module &quot;import as&quot;</span>

<span class="n">TN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>


<span class="c1"># 1) Familiarise yourself with the visualising things on the Tonnetz by drawing:</span>
<span class="c1">#     - a path of pitch classes: C-G-D#-E</span>
<span class="c1">#     - a path of triads: C-G-g-c-A</span>
<span class="c1"># 2) Also implement a `pitch_class` function that transforms lists of locations (e.g. a path) to a number in {0,...,11} representing the pitch class as MIDI number.</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_001.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_001.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x700 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
<section id="hints">
<h2>Hints:<a class="headerlink" href="#hints" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><cite>Tonnetz.plot</cite> plots the Tonnetz and returns <cite>(figure, axis)</cite>, so you can add additional plots to <cite>axis</cite>.</p></li>
<li><p>You can specify locations in <cite>(fifths, thirds)</cite>-steps or <cite>indices</cite> with the pitch class <cite>C</cite> corresponding to <cite>(0, 0)</cite>.</p></li>
<li><p>When working with enharmonically equivalent pitch classes (as in MIDI), you can remap lists of indices to the unit cell using <cite>Tonnetz.remap_to_unit_cell</cite>.</p></li>
<li><p>You can transform lists of indices to x/y-coordinates for plotting using the <cite>Tonnetz.indices_to_coords</cite> function.</p></li>
<li><p><cite>Tonnetz.ma_off</cite> and <cite>Tonnetz.mi_off</cite> give the offsets (in x/y-coordinates) of major and minor chords, respectively, relative to their root pitch class.</p></li>
<li><p>A fifth are 7 semitone steps and a major third 4.</p></li>
<li><p>You can convert and print the MIDI pitch classes using <cite>Enharmonic.PitchClass</cite> from the <cite>pitchtypes</cite> library.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pitch_class</span><span class="p">(</span><span class="n">locs</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">]</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">PitchClass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pitch_class</span><span class="p">(</span><span class="n">path</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">remap_to_unit_cell</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">path</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">PitchClass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pitch_class</span><span class="p">(</span><span class="n">path</span><span class="p">)])</span>
<span class="n">ma_mi_offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">TN</span><span class="o">.</span><span class="n">ma_off</span><span class="p">,</span> <span class="n">TN</span><span class="o">.</span><span class="n">ma_off</span><span class="p">,</span> <span class="n">TN</span><span class="o">.</span><span class="n">mi_off</span><span class="p">,</span> <span class="n">TN</span><span class="o">.</span><span class="n">mi_off</span><span class="p">,</span> <span class="n">TN</span><span class="o">.</span><span class="n">ma_off</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ma_mi_offset</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">remap_to_unit_cell</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ma_mi_offset</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># ## Sample Paths</span>

<span class="c1"># Generate paths (of a fixed length for now) on the Tonnetz by sampling steps along the three axes of the Tonnetz with different probabilities. Visualise them to get an intuition.</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_002.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_002.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[C, G, D#, E]
[C, G, G, C, A]

[&lt;matplotlib.lines.Line2D object at 0x7faf90908970&gt;]
</pre></div>
</div>
</section>
<section id="id1">
<h2>Hints:<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Steps should be defined in terms of fifths and major thirds.</p></li>
<li><p>The third axis of the Tonnetz corresponds to a <em>minor</em> third, which is the difference of a fifth and a major third.</p></li>
<li><p><cite>numpy.random.choice</cite> is your friend for sampling indices with given probabilites.</p></li>
<li><p>Adding a bit of random noise to paths can make it easier to follow if it goes back and forth.</p></li>
<li><p>You can change <cite>Tonnetz.margin_factor</cite> (default is 1) to increase the area of the Tonnetz if paths go outside the drawing area.</p></li>
<li><p>You can use <cite>np.cumsum</cite> to add up steps.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sample_step</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span>
                <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># fifth up</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># fifth down</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># major third up</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># major third down</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># minor third up</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c1"># minor third down</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
                <span class="p">]</span>
<span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">/=</span> <span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">steps</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sample_path</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_step</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">steps</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sample_step</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sample_path</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[0, 1]
[[0 0]
 [1 0]
 [2 0]
 [1 0]
 [1 1]
 [1 2]]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample_path</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">remap_to_unit_cell</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">path</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">path</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># Now generalise the path sampling by also randomising the path length. Define an `extend(n)` function, which returns the probability to further extend a path of length `n`.</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_003.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_003.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x7faf9046f040&gt;]
</pre></div>
</div>
</section>
<section id="id2">
<h2>Hints:<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>you can start by just returning a constant probability and later experiment with other functions</p></li>
<li><dl class="simple">
<dt>the plots below show you</dt><dd><ul>
<li><p>the probability to extend at each step</p></li>
<li><p>the cumulative probability, that is, the probability of reaching <em>at least</em> this step</p></li>
<li><p>the length probability, that is, the probability to reach <em>exactly</em> this step</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="c1">#     return 0.9</span>
    <span class="k">return</span> <span class="mf">0.7</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">extend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="n">cum_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">probs</span><span class="p">)))])</span>
<span class="n">len_probs</span> <span class="o">=</span> <span class="n">cum_probs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">probs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">len_probs</span><span class="p">)</span><span class="si">}</span><span class="s2"> approx. 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;step-wise probabilities&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cum_probs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cumulative probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">len_probs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;length probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="c1"># Update the `sample_path` function to use the `extend` function.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_004.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_004.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.9997254169637901 approx. 1

&lt;matplotlib.legend.Legend object at 0x7faf90419de0&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sample_path</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">extend</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)):</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_step</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">steps</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample_path</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="c1"># path = TN.remap_to_unit_cell(path)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">path</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">path</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># ## Sample Distributions [optional]</span>

<span class="c1"># Generate a number of paths and plot the distribution over their end points. This corresponds to a Monte Carlo approximation of the distribution defined by the Tonal Diffusion Model.</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_005.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_005.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x7faf8aae6680&gt;]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_path</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)]</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">remap_to_unit_cell</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="n">locations</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">locations</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="n">counts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">counts</span><span class="p">)</span>
<span class="c1"># ax.scatter(*(locations).T, s=5000*counts)</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># ## Stack Automaton</span>

<span class="c1"># Now, you know how to extend a path by sampling new steps and, of course, you can also shorten a path by dropping elements from its end. This is all you need for implementing a stack automaton:</span>
<span class="c1"># - start with a stack containing a single location (say, `[0, 0]`) and an empty sequence</span>
<span class="c1"># - with the `extend` probability, sample a step and push/append the *resulting location* to the stack</span>
<span class="c1"># - if you do not extend the stack, pop its last element and append it to the sequence</span>
<span class="c1"># - keep going until the stack is empty (you can restart if you want to get a minimum sequence length)</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_006.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_006.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection object at 0x7faf90ddfa30&gt;
</pre></div>
</div>
</section>
<section id="id3">
<h2>Hints:<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>make sure your <cite>extend</cite> probability is always below 1, otherwise the stack will never become empty and the automaton will not terminate</p></li>
<li><p>you can transform the sequence of locations to pitch classes using the <cite>pitch_class</cite> function from above</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">stack_automaton</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">extend</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sample_step</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># break</span>
        <span class="k">if</span> <span class="n">max_len</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">max_len</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1"># restart</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_len</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="k">return</span> <span class="n">sequence</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">stack_automaton</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">PitchClass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pitch_class</span><span class="p">(</span><span class="n">seq</span><span class="p">)])</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">remap_to_unit_cell</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">indices_to_coords</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">TN</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


<span class="c1"># ## Melodies</span>

<span class="c1"># Transform the sequence of pitch classes to actual pitches by defining the octave (i.e., adding some multiple of 12 to the MIDI pitch class).</span>
<span class="c1">#</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_007.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_007.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[C, C, C, C, F, G, C, B, C, B, E, C]

[&lt;matplotlib.lines.Line2D object at 0x7faf90dcec20&gt;]
</pre></div>
</div>
</section>
<section id="id4">
<h2>Hints:<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>you can try to avoid large jumps at the octave boundaries by allowing for a larger window of pitches and trying to define the octave of the next pitch such that the step to the previous pitch is as small as possible</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">to_melody</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">min_pitch</span><span class="o">=</span><span class="mi">58</span><span class="p">,</span> <span class="n">max_pitch</span><span class="o">=</span><span class="mi">72</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">melody</span><span class="p">:</span>
            <span class="n">p_</span> <span class="o">=</span> <span class="n">melody</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">p</span> <span class="o">-</span> <span class="n">p_</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">-=</span> <span class="mi">12</span>
            <span class="k">while</span> <span class="n">p</span> <span class="o">-</span> <span class="n">p_</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">+=</span> <span class="mi">12</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">max_pitch</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">-=</span> <span class="mi">12</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">min_pitch</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">+=</span> <span class="mi">12</span>
        <span class="n">melody</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="k">return</span> <span class="n">melody</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_melody</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">to_melody</span><span class="p">(</span><span class="n">pitch_class</span><span class="p">(</span><span class="n">stack_automaton</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span>

<span class="n">melody</span> <span class="o">=</span> <span class="n">get_melody</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">melody</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[62, 62, 67, 67, 65, 65, 63, 63, 62, 58, 65, 70, 65, 60]
[D4, D4, G4, G4, F4, F4, D#4, D#4, D4, A#3, F4, A#4, F4, C4]
</pre></div>
</div>
</section>
<section id="on-ncc">
<h2>On NCC:<a class="headerlink" href="#on-ncc" title="Link to this heading"></a></h2>
<p>Use the <cite>muprocdurham.sound.sound</cite> function to generate and play the melody with simple sinodial tones.
- <strong>Hints:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>use <cite>Enharmonic.Pitch(…).freq()</cite> to get the correct frequencies (or compute by hand as learned in the lecture)</p></li>
</ul>
</div></blockquote>
<p>%%
On your own machine:
——————–</p>
<p>Use <cite>music21</cite> to make a score and play the melody.</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Hints:</strong></dt><dd><ul>
<li><p>start by creating a <cite>music21.stream.Stream</cite> object</p></li>
<li><p>create <cite>music21.note.Note</cite> objects using the MIDI pitch from the melody and append these to the stream</p></li>
<li><p>you can set the duration of notes by changing their <cite>quarterLength</cite> property</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">melody</span> <span class="o">=</span> <span class="n">get_melody</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[C4, C4, G4, D#4, C4, C4, C4, G4, C5, F4, A#4, A#4, A#4, A4, D4, G4, C5, C5, F4, C4]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># NCC</span>
<span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">stream</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">sound</span><span class="p">(</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">freq</span><span class="p">(),</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.125</span><span class="p">)))</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="n">mps</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># with music21</span>
<span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">quarterLength</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># stream.show()</span>
<span class="c1"># m21.midi.realtime.StreamPlayer(stream).play()</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>


<span class="c1"># ## Rhythm</span>

<span class="c1"># Below is a function that generates a very simple rhythm as a sequence of `(duration, beat)` pairs, where `duration` is the event&#39;s duration in quarter beats and `beat` indicates whether the event is a note (`True`) or a rest (`False`). Use this to add a rhythm to the melody.</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_rhythm</span><span class="p">(</span><span class="n">n_bars</span><span class="p">,</span> <span class="n">split_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">beat_prob</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">max_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">min_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">overall_rhythm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># generate bars independently</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bars</span><span class="p">):</span>
        <span class="c1"># recursively split</span>
        <span class="n">rhythm</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>  <span class="c1"># (duration, terminal, beat)</span>
        <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_splits</span><span class="p">):</span>
            <span class="n">new_rhythm</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rhythm</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                    <span class="c1"># keep terminals unchanged</span>
                    <span class="n">new_rhythm</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">min_splits</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">split_prob</span><span class="p">:</span>
                    <span class="c1"># split (without terminating)</span>
                    <span class="n">new_rhythm</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">beat_prob</span><span class="p">:</span>
                    <span class="c1"># terminat with a beat</span>
                    <span class="n">new_rhythm</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">d</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># terminate with a rest</span>
                    <span class="n">new_rhythm</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">d</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
            <span class="n">rhythm</span> <span class="o">=</span> <span class="n">new_rhythm</span>
        <span class="c1"># fill non-terminated and drop terminal flag</span>
        <span class="n">new_rhythm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rhythm</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">beat_prob</span>
            <span class="n">new_rhythm</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="n">overall_rhythm</span> <span class="o">+=</span> <span class="n">new_rhythm</span>
    <span class="c1"># append one final closing beat</span>
    <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
        <span class="n">overall_rhythm</span> <span class="o">+=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">overall_rhythm</span>

<span class="n">get_rhythm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[(0.5, True), (0.5, True), (1.0, True), (1.0, True), (0.5, True), (0.5, True), (4, True)]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">rhythm_and_melody</span><span class="p">(</span><span class="n">rhythm</span><span class="p">,</span> <span class="n">melody</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">play</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_m21</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
    <span class="k">if</span> <span class="n">use_m21</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">melody</span><span class="p">,</span> <span class="n">rhythm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_m21</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">Rest</span><span class="p">()</span>
            <span class="n">n</span><span class="o">.</span><span class="n">quarterLength</span> <span class="o">=</span> <span class="n">d</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">freq</span><span class="p">()</span> <span class="k">if</span> <span class="n">b</span> <span class="k">else</span> <span class="mi">440</span>
            <span class="n">quarterduration</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># default speed is 120 in music21</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">mps</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">mps</span><span class="o">.</span><span class="n">sound</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">quarterduration</span> <span class="o">*</span> <span class="n">d</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># silence</span>
    <span class="k">if</span> <span class="n">use_m21</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">play</span><span class="p">:</span>
            <span class="n">m21</span><span class="o">.</span><span class="n">midi</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">StreamPlayer</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">mps</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">play</span><span class="p">:</span>
            <span class="n">mps</span><span class="o">.</span><span class="n">audio</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="n">melody</span> <span class="o">=</span> <span class="n">get_melody</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_len</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">rhythm</span> <span class="o">=</span> <span class="n">get_rhythm</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">Enharmonic</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rhythm</span><span class="p">)</span>
<span class="c1"># rhythm_and_melody(rhythm=rhythm, melody=melody)</span>
<span class="c1"># rhythm_and_melody(rhythm=rhythm, melody=melody, use_m21=True)</span>


<span class="c1"># ## Random Melody</span>

<span class="c1"># Generate a random melody and compare its character to the melody generated using the Tonnetz.</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[C4, E4, D4, G4, G4, D#4, C#4, G#4, G#4, A#4, G#4, D#4, A#4, D#4, A#4, A#4, D#4, G#4, G4, G#4]
[(1.0, True), (1.0, False), (1.0, True), (0.5, True), (0.5, True), (0.5, True), (0.5, True), (1.0, True), (0.25, False), (0.25, True), (0.25, True), (0.25, True), (0.5, True), (0.5, True), (1.0, False), (1.0, True), (0.25, True), (0.25, True), (0.25, True), (0.25, True), (0.5, False), (0.25, True), (0.25, True), (1.0, True), (0.25, True), (0.25, True), (0.25, True), (0.25, True), (1.0, True), (1.0, False), (4, True)]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span>
<span class="n">melody</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">rhythm</span> <span class="o">=</span> <span class="n">get_rhythm</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">rhythm_and_melody</span><span class="p">(</span><span class="n">rhythm</span><span class="p">,</span> <span class="n">melody</span><span class="p">)</span>


<span class="c1"># ## More possibilities...</span>

<span class="c1"># The Tonnetz melody does sound &quot;less random&quot; than the actual random melody. But it still does not sound like a &quot;proper&quot; melody. There are several reasons for this, the main one being that the Tonnetz generates harmonically related pitch classes that do not always result in nice melodic lines. There are several directions to further experiment and improve the generation:</span>
<span class="c1"># - The melodies can be elaborated, for instance, by repeating notes (e.g. sampling additional notes from the last *k* notes in the original sequence), adding ornamentations (such as trills or neighbour notes), or by filling larger jumps with intermediate notes to generate smoother melodic lines.</span>
<span class="c1"># - Instead of using the pitch-based version of the Tonnetz, one can use the triad based version with 5 possible steps corresponding to moving up/down on the line/circle of fifths and the three Neo-Riemannian transformations. Pitches can then be sampled from the respective triads (hint: good melodic lines emphasise the *changing* notes in the chord).</span>
<span class="c1"># - For a given chord, the corresponding scale can be used to generate additional notes and filling patterns (as above but better matching the current harmony).</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_Practical_Tonnetz_Generation_008.png" srcset="../_images/sphx_glr_Practical_Tonnetz_Generation_008.png" alt="Practical Tonnetz Generation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;IPython.lib.display.Audio object&gt;
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 3.199 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-practical-tonnetz-generation-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/150f410b9a8fc74dc01762eb8ddc3fae/Practical_Tonnetz_Generation.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">Practical_Tonnetz_Generation.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c11c2597710998ad215bf070792f402c/Practical_Tonnetz_Generation.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">Practical_Tonnetz_Generation.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/272fb66e4f2333a747f97992435bff6d/Practical_Tonnetz_Generation.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">Practical_Tonnetz_Generation.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Practical_Shepard_Tones_and_Pitch-Class_Embeddings.html" class="btn btn-neutral float-left" title="Shepard Tones" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api_summary.html" class="btn btn-neutral float-right" title="API Summary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Robert Lieck, Eamonn Bell, Mark Gotham.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>